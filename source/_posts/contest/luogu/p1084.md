---
title: P1084疫情控制
date: 2022-02-07 17:00:00
categories: acm
tag: luogu
---

{% link '疫情控制' https://www.luogu.com.cn/problem/solution/P1084 [title] %}

```py
# edge of tree
v = []
# emery
p = []
# bei zeng
fa, dis = [], []
sta, need = [], []


def dfs(root, now, now_fa):
    for vx in v[root]:
        son = vx[0]
        w = vx[1]
        if son != now_fa:
            # print("son:", son)
            fa[son][0] = root
            dis[son][0] = w
            for i in range(1, 20):
                fa[son][i] = fa[fa[son][i - 1]][i - 1]
                dis[son][i] = dis[fa[son][i - 1]][i - 1] + dis[son][i - 1]
            dfs(son, now + w, root)


def find_need(root, pre):
    if sta[root]:
        need[root] = False
        return False
    for vx in v[root]:
        son = vx[0]
        if son == pre:
            continue
        if find_need(son, root):
            need[root] = True
    return need[root]


def check(limit, n, m):
    for i in range(n + 1):
        sta[i] = False
        need[i] = True

    prepare = []

    for i in range(m):
        pos = p[i]
        cur = 0
        for j in reversed(range(20)):
            if fa[pos][j] > 1 and cur + dis[pos][j] <= limit:
                pos = fa[pos][j]
                cur += dis[pos][j]
        if fa[pos][0] == 1 and cur <= limit:
            prepare.append({limit - cur, pos})
        else:
            sta[pos] = True

    for vx in v[1]:
        if find_need(vx[0], 1):
            

    return False


def solve():
    n = int(input().strip())

    global v, fa, dis
    v = [[] for i in range(n + 1)]
    fa = [[] for i in range(n + 1)]
    dis = [[] for i in range(n + 1)]
    for i in range(n + 1):
        for j in range(20):
            fa[i].append(0)
            dis[i].append(0)

    sum = 0
    for i in range(n - 1):
        f, t, w = map(int, input().strip().split())
        # print(f, t, w)
        v[f].append([t, w])
        v[t].append([f, w])
        sum += w

    m = int(input().strip())
    p = map(int, input().strip().split())

    dfs(1, 0, 0)

    # for i in range(1, n + 1):
    #     for j in range(20):
    #         if fa[i][j] == 0:
    #             continue
    #         print("now:", i, "fa: ", fa[i][j], "dis: ", dis[i][j])

    # l = 0
    # r = sum
    # while l < r:
    #     mid = (l + r) >> 1
    #     if check(mid):
    #         r = mid
    #     else:
    #         l = mid
    # print(r)


# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    solve()

# See PyCharm help at https://www.jetbrains.com/help/pycharm/
# 4
# 1 2 1
# 1 3 2
# 3 4 3
# 2
# 2 2

```
